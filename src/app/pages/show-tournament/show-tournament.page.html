<ion-header class="ion-no-border" [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button
        defaultHref="/tabs/tournaments"
        text="Retour"
      ></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Skeleton pendant le chargement -->
  <ng-container *ngIf="loading">
    <ion-card>
      <ion-card-header>
        <ion-skeleton-text
          animated
          style="width: 60%; height: 24px"
        ></ion-skeleton-text>
      </ion-card-header>
      <ion-card-content>
        <ion-skeleton-text
          animated
          style="width: 100%; height: 16px; margin-bottom: 8px"
        ></ion-skeleton-text>
        <ion-skeleton-text
          animated
          style="width: 80%; height: 16px"
        ></ion-skeleton-text>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <!-- Affichage des données réelles -->
  <ng-container *ngIf="!loading && tournament">
    <ion-grid>
      <ion-card-header>
        <ion-card-title>{{ tournament.title }}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="card-row">
          <p class="game-name">
            <img
              *ngIf="tournament.game?.logo"
              [src]="'https://www.citypng.com/public/uploads/preview/pubg-white-silhouette-soldier-with-helmet-logo-733961695143126pruerybiwc.png'"
              alt="logo"
              style="
                width: 24px;
                height: 24px;
                vertical-align: middle;
                margin-right: 6px;
              "
            />
            {{ tournament.game?.name }}
          </p>
          <ion-chip class="status-chip" [ngClass]="tournament.status">
            <ion-icon
              color="light"
              [name]="tournament.status === 'upcoming' ? 'calendar-outline' : (tournament.status === 'ongoing' ? 'play-outline' : 'checkmark-outline')"
            ></ion-icon>
            <ion-label>
              {{ tournament.status === 'upcoming' ? 'À venir' :
              (tournament.status === 'ongoing' ? 'En cours' : 'Terminé') }}
            </ion-label>
          </ion-chip>
        </div>
      </ion-card-content>

      <!-- Informations du tournoi -->
      <ion-card class="tournament-info-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="trophy" color="warning"></ion-icon>
            Informations du tournoi
          </ion-card-title>
          <ion-card-subtitle>
            <div class="card-row">
              <span
                ><strong>Date :</strong> {{ tournament.date | date:'dd/MM/yyyy'
                }}</span
              >
              <span class="prize"
                ><strong>Mode :</strong> {{ tournament.mode }}</span
              >
            </div>
          </ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <p class="section-title">Description</p>
          <ion-text class="ion-text-justify">
            <p>{{ tournament.description }}</p>
          </ion-text>
          <p class="section-title">Règles</p>
          <ion-text class="ion-text-justify">
            <ul class="rules-list">
              <li *ngFor="let rule of (tournament.rules | jsonParse)">
                {{ rule }}
              </li>
            </ul>
          </ion-text>
          <ion-button expand="block" shape="round" color="primary">
            S'inscrire au tournoi
          </ion-button>
        </ion-card-content>
      </ion-card>
      <ion-card class="participants-card">
        <ion-card-header>
          <ion-card-title
            ><ion-icon color="success" name="people-outline"></ion-icon>
            Participants inscrits ({{ tournament.participants ?
            tournament.participants.length : 0 }})</ion-card-title
          >
        </ion-card-header>
        <div class="participants-list">
          <ion-card
            class="participant-card"
            *ngIf="tournament.participants && tournament.participants.length > 0; else noParticipants"
          >
            <div
              class="participant-content"
              *ngFor="let participant of tournament.participants"
            >
              <ion-avatar>
                <img
                  [src]="participant.avatar || 'https://placehold.co/40'"
                  alt="ProGamer_77"
                />
              </ion-avatar>
              <div class="participant-info">
                <h2>{{ participant.name }}</h2>
                <p>Rang #{{ participant.rank }}</p>
              </div>

              <ion-button fill="clear" size="small" color="primary">
                {{ participant.points }} pts
              </ion-button>
            </div>
          </ion-card>
          <ng-template #noParticipants>
            <ion-card class="no-participant-card">
              <ion-card-content>
                <p>Aucun participant pour ce tournoi.</p>
              </ion-card-content>
            </ion-card>
          </ng-template>
        </div>
      </ion-card>
    </ion-grid>
  </ng-container>
</ion-content>
