<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Affrontements</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Pull to refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content
      pullingIcon="chevron-down-circle-outline"
      pullingText="Tirez pour actualiser"
      refreshingSpinner="crescent"
      refreshingText="Actualisation..."
    ></ion-refresher-content>
  </ion-refresher>

  <!-- Filtre par statut -->
  <ion-segment
    mode="ios"
    scrollable
    value="{{selectedStatus}}"
    (ionChange)="selectStatus($event.detail.value)"
    class="custom-segment"
  >
    <ion-segment-button value="À venir">
      <ion-label>À venir</ion-label>
    </ion-segment-button>

    <ion-segment-button value="En cours">
      <ion-label>En cours</ion-label>
    </ion-segment-button>
    <ion-segment-button value="Terminé">
      <ion-label>Terminé</ion-label>
    </ion-segment-button>
    <ion-segment-button value="Annulé">
      <ion-label>Annulé</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Compteur de résultats -->
  <div class="result-counter" *ngIf="!isLoading">
    <ion-text color="medium">
      <p>
        {{ filteredMatches.length }} affrontement{{ filteredMatches.length > 1 ?
        's' : '' }} trouvé{{ filteredMatches.length > 1 ? 's' : '' }}
      </p>
    </ion-text>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <ion-text color="medium">
      <p>Chargement des affrontements...</p>
    </ion-text>
  </div>

  <!-- Liste des affrontements -->
  <div class="matches-container" *ngIf="!isLoading">
    <ion-card
      *ngFor="let match of filteredMatches"
      class="match-card"
      [class.live-match]="match.status === 'in_progress'"
    >
      <!-- Contenu du match -->
      <ion-card-content>
        <div class="match-header">
          <span class="competition-name">{{ match.competition.name }}</span>
          <span class="competition-title" *ngIf="match.competition.title"
            >{{ match.competition.title }}</span
          >
          <ion-chip [color]="getStatusColor(match.status)" class="status-chip">
            <ion-label>{{ getStatusLabel(match.status) }}</ion-label>
          </ion-chip>
        </div>

        <div class="teams-container">
          <div class="team team1">
            <div class="team-info">
              <div class="team-logo-container">
                <img
                  *ngIf="match.team1.logo"
                  [src]="match.team1.logo"
                  [alt]="match.team1.name + ' logo'"
                  class="team-logo"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
                />
                <ion-icon
                  name="shield-outline"
                  size="small"
                  class="team-icon"
                  [style.display]="match.team1.logo ? 'none' : 'flex'"
                ></ion-icon>
              </div>
              <span class="team-name" [title]="match.team1.name"
                >{{ match.team1.name }}</span
              >
            </div>
            <span
              class="team-score"
              [class.winner]="match.status === 'completed' && match.team1_score !== null && match.team2_score !== null && match.team1_score > match.team2_score"
            >
              {{ match.team1_score !== null ? match.team1_score : '-' }}
            </span>
          </div>

          <div class="vs-separator">
            <span>VS</span>
          </div>

          <div class="team team2">
            <span
              class="team-score"
              [class.winner]="match.status === 'completed' && match.team1_score !== null && match.team2_score !== null && match.team2_score > match.team1_score"
            >
              {{ match.team2_score !== null ? match.team2_score : '-' }}
            </span>
            <div class="team-info">
              <span class="team-name" [title]="match.team2.name"
                >{{ match.team2.name }}</span
              >
              <div class="team-logo-container">
                <img
                  *ngIf="match.team2.logo"
                  [src]="match.team2.logo"
                  [alt]="match.team2.name + ' logo'"
                  class="team-logo"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
                />
                <ion-icon
                  name="shield-outline"
                  size="small"
                  class="team-icon"
                  [style.display]="match.team2.logo ? 'none' : 'flex'"
                ></ion-icon>
              </div>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Message si aucun résultat -->
  <div *ngIf="filteredMatches.length === 0" class="no-results">
    <ion-icon name="trophy-outline" size="large" color="medium"></ion-icon>
    <ion-text color="medium">
      <h2>Aucun affrontement trouvé</h2>
      <p>Aucun affrontement ne correspond aux filtres sélectionnés.</p>
    </ion-text>
  </div>
  <!-- Bouton d'action flottant pour actualisation -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" class="refresh-fab">
    <ion-fab-button
      color="primary"
      size="small"
      (click)="doRefresh()"
      class="refresh-fab-button"
    >
      <ion-icon name="refresh-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
