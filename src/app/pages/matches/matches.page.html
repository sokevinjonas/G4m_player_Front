<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Affrontements</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Filtre par statut -->
  <ion-segment
    mode="ios"
    scrollable
    value="{{selectedStatus}}"
    (ionChange)="selectStatus($event.detail.value)"
    class="custom-segment"
  >
    <ion-segment-button value="Tous">
      <ion-label>Tous</ion-label>
    </ion-segment-button>
    <ion-segment-button value="À venir">
      <ion-label>Programmé</ion-label>
    </ion-segment-button>
    <ion-segment-button value="En cours">
      <ion-label>En cours</ion-label>
    </ion-segment-button>
    <ion-segment-button value="Terminé">
      <ion-label>Terminé</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Compteur de résultats -->
  <div class="result-counter">
    <ion-text color="medium">
      <p>
        {{ filteredMatches.length }} affrontement{{ filteredMatches.length > 1 ?
        's' : '' }} trouvé{{ filteredMatches.length > 1 ? 's' : '' }}
      </p>
    </ion-text>
  </div>

  <!-- Liste des affrontements -->
  <div class="matches-container">
    <ion-card
      *ngFor="let match of filteredMatches"
      class="match-card"
      [class.live-match]="match.status === 'in_progress'"
    >
      <!-- Contenu du match -->
      <ion-card-content>
        <div class="match-header">
          <span class="competition-name">{{ match.competition.name }}</span>
          <ion-chip [color]="getStatusColor(match.status)" class="status-chip">
            <ion-label>{{ getStatusLabel(match.status) }}</ion-label>
          </ion-chip>
        </div>

        <div class="match-phase">
          {{ getPhaseLabel(match.phase) }}
          <span
            *ngIf="match.scheduled_at && (match.status === 'scheduled' || match.status === 'pending')"
            class="scheduled-time"
          >
            • {{ match.scheduled_at | date:'dd/MM à HH:mm' }}
          </span>
        </div>

        <div class="teams-container">
          <div class="team team1">
            <div class="team-info">
              <ion-icon name="shield-outline" size="small"></ion-icon>
              <span class="team-name">{{ match.team1.name }}</span>
            </div>
            <span
              class="team-score"
              [class.winner]="match.status === 'completed' && match.team1_score !== null && match.team2_score !== null && match.team1_score > match.team2_score"
            >
              {{ match.team1_score !== null ? match.team1_score : '-' }}
            </span>
          </div>

          <div class="vs-separator">
            <span>VS</span>
          </div>

          <div class="team team2">
            <span
              class="team-score"
              [class.winner]="match.status === 'completed' && match.team1_score !== null && match.team2_score !== null && match.team2_score > match.team1_score"
            >
              {{ match.team2_score !== null ? match.team2_score : '-' }}
            </span>
            <div class="team-info">
              <span class="team-name">{{ match.team2.name }}</span>
              <ion-icon name="shield-outline" size="small"></ion-icon>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Message si aucun résultat -->
  <div *ngIf="filteredMatches.length === 0" class="no-results">
    <ion-icon name="trophy-outline" size="large" color="medium"></ion-icon>
    <ion-text color="medium">
      <h2>Aucun affrontement trouvé</h2>
      <p>Aucun affrontement ne correspond aux filtres sélectionnés.</p>
    </ion-text>
  </div>
  <!-- Bouton d'action flottant pour actualisation -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" class="refresh-fab">
    <ion-fab-button
      color="primary"
      size="small"
      (click)="doRefresh()"
      class="refresh-fab-button"
    >
      <ion-icon name="refresh-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
